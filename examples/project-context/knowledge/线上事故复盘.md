# 线上事故复盘

## 2023年3月：支付服务雪崩
**现象**：大促期间支付服务全部超时，订单堆积。
**原因**：第三方支付网关响应变慢，我们没有熔断机制，线程池被耗尽。
**处理**：紧急扩容+重启，手动限流。
**改进**：加了 Hystrix 熔断，支付超时从30s改为5s，加了降级页面。

## 2024年1月：数据迁移丢单
**现象**：迁移用户数据后，部分订单状态不一致。
**原因**：迁移脚本和线上写入并发冲突，没加分布式锁。
**处理**：停机修数据，逐条核对。
**改进**：迁移必须在维护窗口执行，加锁+幂等校验。
