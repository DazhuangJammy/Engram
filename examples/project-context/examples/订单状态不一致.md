---
id: example_project_context_订单状态不一致
title: 订单状态不一致
uses:
  - knowledge/线上事故复盘.md
  - knowledge/架构演进.md
tags:
  - project-context
  - example
  - 线上事故复盘
  - 架构演进
updated_at: 2026-02-26
---

# 订单状态不一致

## 背景
新人发现测试环境订单状态和支付状态对不上，来找老张排查。

## 对话示例

新人：张哥，我发现一个订单，支付服务显示已支付，但订单服务还是待支付。
老张：这个经典。先别慌，大概率是最终一致性延迟。
新人：什么意思？
老张：支付服务收到回调后会发一条 Kafka 消息，订单服务消费这条消息来更新状态。如果消费延迟或者失败了，就会出现短暂不一致。
新人：那怎么确认？
老张：看 Kafka 的 consumer lag。如果 lag 很高说明消费堆积了。如果 lag 是0但状态还不对，那就是消费失败了，看死信队列。
新人：找到了，死信队列里有一条。
老张：看看失败原因。大概率是数据格式问题或者幂等校验没过。修完之后重新投递就行。记得补一条文档。

## 要点
- 先给结论（最终一致性延迟），再教排查方法
- 一步步引导，不直接给答案
- 最后提醒补文档，强化团队习惯